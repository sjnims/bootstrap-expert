<%#
  Rails Form with Bootstrap 5.3.8 Styling

  This example demonstrates:
  - Rails form_with helper with Bootstrap classes
  - Server-side validation error display
  - Client-side HTML5 validation with Bootstrap styling
  - Various input types with Bootstrap form classes
  - Stimulus controller for validation UX

  Usage: Adapt this pattern for your model forms

  DEPENDENCIES:

  Routes (adapt to your application):
  - terms_path (Terms of Service page)
  - new_session_path (login page for "Already have an account?" link)

  Model:
  - @user (or your registration model with validations)
%>

<%# Registration Form Example %>
<div class="row justify-content-center">
  <div class="col-lg-6 col-md-8">
    <div class="card shadow-sm">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">
          <i class="bi bi-person-plus me-2"></i>Create Account
        </h4>
      </div>

      <div class="card-body">
        <%#
          form_with automatically:
          - Sets authenticity token
          - Determines POST vs PATCH based on model.persisted?
          - Adds data-turbo="true" by default

          novalidate: true disables browser validation UI
          data-controller connects Stimulus for custom validation
        %>
        <%= form_with model: @user,
                      class: "needs-validation",
                      novalidate: true,
                      data: { controller: "form-validation",
                              action: "submit->form-validation#validate" } do |f| %>

          <%# Display model errors at top of form %>
          <% if @user.errors.any? %>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
              <strong>
                <i class="bi bi-exclamation-triangle me-1"></i>
                <%= pluralize(@user.errors.count, "error") %> prohibited this user from being saved:
              </strong>
              <ul class="mb-0 mt-2">
                <% @user.errors.full_messages.each do |message| %>
                  <li><%= message %></li>
                <% end %>
              </ul>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
          <% end %>

          <%# Name fields - two column layout on medium+ screens %>
          <div class="row g-3 mb-3">
            <div class="col-md-6">
              <%= f.label :first_name, class: "form-label" %>
              <%= f.text_field :first_name,
                               class: "form-control #{'is-invalid' if @user.errors[:first_name].any?}",
                               required: true,
                               autofocus: true %>
              <%#
                Validation feedback pattern:
                - "d-block" forces display for server-side Rails errors (shows immediately)
                - Without "d-block" for client-side HTML5 validation (shows on :invalid state)
              %>
              <% if @user.errors[:first_name].any? %>
                <div class="invalid-feedback d-block">
                  <%= @user.errors[:first_name].first %>
                </div>
              <% else %>
                <div class="invalid-feedback">Please enter your first name.</div>
              <% end %>
            </div>

            <div class="col-md-6">
              <%= f.label :last_name, class: "form-label" %>
              <%= f.text_field :last_name,
                               class: "form-control #{'is-invalid' if @user.errors[:last_name].any?}",
                               required: true %>
              <% if @user.errors[:last_name].any? %>
                <div class="invalid-feedback d-block">
                  <%= @user.errors[:last_name].first %>
                </div>
              <% else %>
                <div class="invalid-feedback">Please enter your last name.</div>
              <% end %>
            </div>
          </div>

          <%# Email with input group %>
          <div class="mb-3">
            <%= f.label :email, class: "form-label" %>
            <div class="input-group has-validation">
              <span class="input-group-text">
                <i class="bi bi-envelope"></i>
              </span>
              <%= f.email_field :email,
                                class: "form-control #{'is-invalid' if @user.errors[:email].any?}",
                                required: true,
                                placeholder: "you@example.com",
                                aria: { describedby: "emailHelp" } %>
              <% if @user.errors[:email].any? %>
                <div class="invalid-feedback">
                  <%= @user.errors[:email].first %>
                </div>
              <% else %>
                <div class="invalid-feedback">Please enter a valid email address.</div>
              <% end %>
            </div>
            <div id="emailHelp" class="form-text">We'll never share your email.</div>
          </div>

          <%# Password with requirements %>
          <div class="mb-3">
            <%= f.label :password, class: "form-label" %>
            <%= f.password_field :password,
                                 class: "form-control #{'is-invalid' if @user.errors[:password].any?}",
                                 required: true,
                                 minlength: 8,
                                 aria: { describedby: "passwordHelp" } %>
            <% if @user.errors[:password].any? %>
              <div class="invalid-feedback d-block">
                <%= @user.errors[:password].first %>
              </div>
            <% else %>
              <div class="invalid-feedback">Password must be at least 8 characters.</div>
            <% end %>
            <div id="passwordHelp" class="form-text">
              Minimum 8 characters with at least one number.
            </div>
          </div>

          <%# Password confirmation %>
          <div class="mb-3">
            <%= f.label :password_confirmation, class: "form-label" %>
            <%= f.password_field :password_confirmation,
                                 class: "form-control #{'is-invalid' if @user.errors[:password_confirmation].any?}",
                                 required: true %>
            <% if @user.errors[:password_confirmation].any? %>
              <div class="invalid-feedback d-block">
                <%= @user.errors[:password_confirmation].first %>
              </div>
            <% else %>
              <div class="invalid-feedback">Please confirm your password.</div>
            <% end %>
          </div>

          <%# Select dropdown %>
          <div class="mb-3">
            <%= f.label :role, class: "form-label" %>
            <%= f.select :role,
                         options_for_select([
                           ["Select a role...", ""],
                           ["Developer", "developer"],
                           ["Designer", "designer"],
                           ["Manager", "manager"]
                         ], @user.role),
                         {},
                         class: "form-select #{'is-invalid' if @user.errors[:role].any?}",
                         required: true %>
            <div class="invalid-feedback">Please select a role.</div>
          </div>

          <%# Checkbox with form-check %>
          <div class="mb-3">
            <div class="form-check">
              <%= f.check_box :terms,
                              class: "form-check-input #{'is-invalid' if @user.errors[:terms].any?}",
                              required: true %>
              <%= f.label :terms, class: "form-check-label" do %>
                I agree to the <%= link_to "Terms of Service", terms_path, target: "_blank" %>
              <% end %>
              <div class="invalid-feedback">You must agree to the terms.</div>
            </div>
          </div>

          <%# Newsletter subscription (optional) %>
          <div class="mb-4">
            <div class="form-check form-switch">
              <%= f.check_box :newsletter, class: "form-check-input", role: "switch" %>
              <%= f.label :newsletter, "Subscribe to newsletter", class: "form-check-label" %>
            </div>
          </div>

          <%# Submit button %>
          <div class="d-grid gap-2">
            <%= f.submit "Create Account", class: "btn btn-primary btn-lg" %>
          </div>

        <% end %>
      </div>

      <div class="card-footer text-center text-muted">
        Already have an account?
        <%= link_to "Sign in", new_session_path, class: "text-decoration-none" %>
      </div>
    </div>
  </div>
</div>

<%#
  Stimulus Controller for Form Validation
  Place in app/javascript/controllers/form_validation_controller.js

  import { Controller } from "@hotwired/stimulus"

  export default class extends Controller {
    validate(event) {
      if (!this.element.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }
      this.element.classList.add("was-validated")
    }
  }
%>
